<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AdminTek - BiblioTek</title>
  <link rel="stylesheet" href="../CSS/EditarUsuario.css">
</head>
<body>
  <div class="container">
    <h1>Editar Usuario</h1>
    <div class="form-group">
      <label for="first_name">Nombre</label>
      <input type="text" id="first_name" class="form-control">
    </div>
    <div class="form-group">
      <label for="last_name">Apellidos</label>
      <input type="text" id="last_name" class="form-control">
    </div>
    <div class="form-group">
      <label for="roles">Tipo de usuario</label>
      <select id="roles" class="form-control">
        <option value="administrador">Administrador</option>
        <option value="miembro">Miembro</option>
      </select>
    </div>
    <div class="form-group">
      <label for="dni">Cédula</label>
      <input type="text" id="dni" class="form-control">
    </div>
    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" class="form-control">
    </div>
    <div class="form-group">
      <label for="password">Password</label>
      <input type="password" id="password" class="form-control">
    </div>
    <button id="update-button" class="btn btn-primary" onclick="updateUser()">Actualizar</button>
  </div>
  <div class="back-button-container">
    <a href="../HTML/AdministrarUsuarios.html" class="back-button">Regresar</a>
</div>
</body>
<!-- Firebase JS SDK -->
<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>

<script>
  // Your web app's Firebase configuration
var firebaseConfig = {
  apiKey: "AIzaSyAUuOzPZ1k3-YKMtQzO1AX9XE_hUgS0LhA",
  authDomain: "bibliotek-6aa3f.firebaseapp.com",
  databaseURL: "https://bibliotek-6aa3f-default-rtdb.firebaseio.com",
  projectId: "bibliotek-6aa3f",
  storageBucket: "bibliotek-6aa3f.appspot.com",
  messagingSenderId: "459978600030",
  appId: "1:459978600030:web:ccd097da5ab5c2c72a4ecf"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Initialize variables
const database = firebase.database()

// Esta función se llama cuando la página se carga
function cargarDatosUsuario() {
  // Obtén el ID del usuario de los parámetros de la URL
  const urlParams = new URLSearchParams(window.location.search);
  const userId = urlParams.get("id");

  // Obtén una referencia al usuario en la base de datos
  const userRef = database.ref("users/" + userId);

  // Lee los datos del usuario
  userRef.once("value").then(function(snapshot) {
    const userData = snapshot.val();

    // Rellena los campos de edición con los datos del usuario
    document.getElementById("first_name").value = userData.first_name;
    document.getElementById("last_name").value = userData.last_name;
    document.getElementById("roles").value = userData.roles;
    document.getElementById("dni").value = userData.dni;
    document.getElementById("email").value = userData.email;
  }).catch(function(error) {
    console.error("Error al cargar los datos del usuario:", error);
  });
}

// Llama a la función para cargar los datos del usuario cuando la página se carga
window.onload = cargarDatosUsuario;

  // Agregar esta función para actualizar los datos del usuario
  function updateUser() {
    // Obtén el valor de userId de la URL
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get("id");

    // Obtén los valores de los campos de edición
    const updatedFirstName = document.getElementById("first_name").value;
    const updatedLastName = document.getElementById("last_name").value;
    const updatedRoles = document.getElementById("roles").value;
    const updatedDni = document.getElementById("dni").value;
    const updatedEmail = document.getElementById("email").value;

    // Crea un objeto con los datos actualizados
    const updatedUserData = {
      first_name: updatedFirstName,
      last_name: updatedLastName,
      roles: updatedRoles,
      dni: updatedDni,
      email: updatedEmail,
    };

    // Actualiza los datos del usuario en la base de datos
    const userRef = database.ref("users/" + userId);
    userRef
      .update(updatedUserData)
      .then(function () {
        // Datos actualizados exitosamente
        alert("Datos actualizados correctamente");
        window.location.href = "/HTML/PrincipalAdmin.html";
        // Redirige a la página principal u otra ubicación después de la actualización
        // window.location.href = "ruta_después_de_actualización";
      })
      .catch(function (error) {
        // Ocurrió un error al actualizar los datos
        alert("Error al actualizar los datos: " + error.message);
      });
  }
</script>

</html>