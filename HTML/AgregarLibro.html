<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Productos</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../CSS/Agregar.css" />
  </head>
  <body>
    <header>
      <div class="volver-container">
        <a href="javascript:history.go(-1)">
          <img src="../IMÁGENES/volver.png" alt="Botón Volver">
        </a>
      </div>
      <a href="../HTML/PrincipalAdmin.html">
        <img src="../IMÁGENES/Logo.png">
      </a>
      <h1 style="color: white;">Agregar Productos</h1>
    </header>
    <div class="d-flex justify-content-center align-items-center">
      <div class="container text-white mt-5">
          <div class="form-group m-4">
            <label for="nombre" style="color: white;">Nombre:</label>
            <input type="text" class="form-control" id="nombre" name="nombre" />
          </div>
          <div class="form-group m-4">
            <label for="autor" style="color: white;">Autor:</label>
            <input type="text" class="form-control" id="autor" name="autor" />
          </div>
          <div class="form-group m-4">
            <label for="anno" style="color: white;">Año:</label>
            <input type="number" class="form-control" id="anno" name="anno" />
          </div>
          <div class="form-group m-4">
            <label for="precio" style="color: white;">Precio:</label>
            <input type="number" class="form-control" id="precio" name="precio" />
          </div>
          <div class="form-group m-4">
            <label for="tipo" style="color: white;">Tipo:</label>
            <select class="form-control" id="tipo" name="tipo">
              <option style="color: black;">Libro</option>
              <option style="color: black;">Revista</option>
              <option style="color: black;">Investigación</option>
            </select>
          </div>
          <div class="form-group m-4">
            <label for="imagen" style="color: white;">Imagen:</label>
            <input type="file" class="form-control-file" id="imagen" name="imagen" />
          </div>
          <button class="btn btn-primary" id="btnGuardar">Guardar</button>
        <br />
        <table class="table text-white m-4">
          <thead>
            <tr>
              <th for="Nombre" style="color: white;">Nombre</th>
              <th for="Autor" style="color: white;">Autor</th>
                <th for="Año" style="color: white;">Año</th>
                  <th for="Precio" style="color: white;">Precio</th>
                    <th for="Tipo" style="color: white;">Tipo</th>
                      <th for="Acciones" style="color: white;">Acciones</th>
            </tr>
          </thead>
          <tbody id="bookList" class="product-list">
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>
                <button class="btn btn-sm btn-warning editar" data-id="${producto.id}" style="color: white;">Editar</button>
                <button class="btn btn-sm btn-danger eliminar" data-id="${producto.id}" style="color: white;">Eliminar</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <style>
      body, h1, label, input, th, td, button {
        color: white;
      }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-storage.js"></script>
    
    <script>
// Your Firebase configuration
var firebaseConfig = {
  apiKey: "AIzaSyAUuOzPZ1k3-YKMtQzO1AX9XE_hUgS0LhA",
  authDomain: "bibliotek-6aa3f.firebaseapp.com",
  databaseURL: "https://bibliotek-6aa3f-default-rtdb.firebaseio.com",
  projectId: "bibliotek-6aa3f",
  storageBucket: "bibliotek-6aa3f.appspot.com",
  messagingSenderId: "459978600030",
  appId: "1:459978600030:web:ccd097da5ab5c2c72a4ecf"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Get a reference to the database
const database = firebase.database();
const storage = firebase.storage(); // Get storage reference

document.getElementById("btnGuardar").addEventListener("click", UploadProcess);

async function UploadProcess() {
  var FileToUpload = document.getElementById("imagen").files[0]; // Get selected file
  var FileName = FileToUpload.name; // Use the file's original name
  const metaData = {
    contentType: FileToUpload.type,
  };
  
  const storageRef = storage.ref("Documentos/" + FileName);
  
  const uploadTask = storageRef.put(FileToUpload, metaData);
  
  uploadTask.on(
    "state_changed",
    (snapshot) => {
      // Handle upload progress if needed
    },
    (error) => {
      alert("Problema para subir la imagen");
    },
    async () => {
      // Get the download URL of the uploaded image
      const downloadURL = await storageRef.getDownloadURL();
      console.log("Download URL:", downloadURL);
      
      // Get book details from the form
      const nombre = document.getElementById("nombre").value;
      const autor = document.getElementById("autor").value;
      const anno = parseInt(document.getElementById("anno").value);
      const precio = parseFloat(document.getElementById("precio").value);
      const tipo = document.getElementById("tipo").value;
      
      // Create a new book object
      const bookData = {
        nombre: nombre,
        autor: autor,
        anno: anno,
        precio: precio,
        tipo: tipo,
        imagenUrl: downloadURL
      };
      
      // Store the book data in the Firebase Realtime Database
      const newBookRef = database.ref("books").push();
      newBookRef.set(bookData); // Store book data

      console.log("Book data stored in the database.");

      document.addEventListener("click", function (event) {
  if (event.target.classList.contains("editar")) {
    const bookId = event.target.getAttribute("data-id");

    // Here, you can implement your logic to show an edit form or take any other action you want.
    // You can use the bookId to identify the book you want to edit.
    console.log("Edit button clicked for book with ID:", bookId);
  }
});
document.addEventListener("click", function (event) {
  if (event.target.classList.contains("eliminar")) {
    const bookId = event.target.getAttribute("data-id");

    // Delete the book data from the Firebase Realtime Database
    database.ref("books").child(bookId).remove();

    // You might also want to remove the row from the table immediately after deletion.
    event.target.closest("tr").remove();
    console.log("Delete button clicked for book with ID:", bookId);
  }
});

      // Fetch and display all books
      database.ref("books").once("value", (snapshot) => {
        const bookList = document.getElementById("bookList");
        bookList.innerHTML = ""; // Clear previous content

        snapshot.forEach((bookSnapshot) => {
          const book = bookSnapshot.val();

          const newRow = document.createElement("tr");
          newRow.innerHTML = `
            <td>${book.nombre}</td>
            <td>${book.autor}</td>
            <td>${book.anno}</td>
            <td>${book.precio}</td>
            <td>${book.tipo}</td>
            <td>
              <button class="btn btn-sm btn-warning editar" data-id="${bookSnapshot.key}" style="color: white;">Editar</button>
              <button class="btn btn-sm btn-danger eliminar" data-id="${bookSnapshot.key}" style="color: white;">Eliminar</button>
            </td>
          `;

          bookList.appendChild(newRow);
        });
      });
      // Add an event listener for the "Editar" button

    }
  );
}
    </script>
  </body>
</html>
