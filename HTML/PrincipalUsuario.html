<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>BiblioTek</title>
    <link href="../CSS/InterfazPrincipal.css" rel="stylesheet" />
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script>
</head>

<body>
    <div class="sidebar">
        <div class="logo-container">
            <img alt="BiblioTek Logo" class="logo" src="../IMÁGENES/Logo.png" />
            <h1 class="heading">BiblioTek</h1>
        </div>
        <nav class="nav-links">
            <a class="sidebar-link" href="../HTML/Perfil.html">
                <img alt="Perfil" src="../IMÁGENES/usuario-de-perfil.png" />
                <span>Mi Cuenta</span>
            </a>
            <a class="sidebar-link" href="../HTML/Explora.html">
                <img alt="Biblioteca" src="../IMÁGENES/wpexplorer.svg" />
                <span>Explora</span>
            </a>
            <a class="sidebar-link" href="../HTML/BooksDashboard.html">
                <img alt="Biblioteca" src="../IMÁGENES/books.svg" />
                <span>Biblioteca</span>
            </a>
            <a class="sidebar-link" href="../HTML/MyBooks.html">
                <img alt="Mis Libros" src="../IMÁGENES/libro.svg" />
                <span>Mis Libros</span>
            </a>
            <a class="sidebar-link" href="../HTML/LogIn.html">
                <img alt="Mis Libros" src="../IMÁGENES/cerrar-sesion.png" />
                <span>SignOut</span>
            </a>
        </nav>
    </div>
    <!-- Tabla para mostrar los libros -->
    <div class="container">
    <table class="table text-white m-4">
        <thead>
            <tr>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Autor</th>
                <th>Año</th>
                <th>Precio</th>
                <th>Tipo</th>
            </tr>
        </thead>
        <tbody class="book-list">
            <!-- Los libros se cargarán aquí desde Firebase -->
        </tbody>
    </table>
    </div>
    <!-- Inclusión de firebase.js -->
    <script src="../JS/firebase.js"></script>
    <script>
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                console.log("Usuario autenticado:", user.uid);
                // Aquí puedes añadir más acciones si el usuario está autenticado.
            } else {
                console.log("Usuario no autenticado");
                window.location.href = 'LogIn.html';  // Redireccionar al usuario al inicio de sesión si no está autenticado.
            }
        });

        // Función para cargar y mostrar libros en la tabla
        function loadBooks() {
            // Referencia a la base de datos donde se almacenan los libros
            const booksRef = database.ref("books");

            // Escuchar los cambios en la referencia "books"
            booksRef.on("child_added", function (snapshot) {
                const book = snapshot.val();

                // Crear una nueva fila para la tabla
                const newRow = document.createElement("tr");

                // Rellenar la fila con los datos del libro
                newRow.innerHTML = `
            <td><a href="${book.docUrl}" target="_blank"><img src="${book.imagenUrl}" alt="${book.nombre}" width="50"></a></td>
                <td>${book.nombre}</td>
                <td>${book.autor}</td>
                <td>${book.anno}</td>
                <td>${book.precio}</td>
                <td>${book.tipo}</td>
            `;

                // Añadir la nueva fila a la tabla
                document.querySelector(".book-list").appendChild(newRow);
            });
        }

        // Llamar a la función loadBooks cuando se carga la página
        window.addEventListener("DOMContentLoaded", loadBooks);
    </script>
</body>

</html>